{% extends "base.html" %}
{% load bootstrap3 %}

{% block header %}
    <h2>
        Evchat
    </h2>
{% endblock header %}

{% block content %}
<form method="post" action="{% url 'create_event' %}">
    {% csrf_token %}
    <h3>Event</h3>
    {% bootstrap_field event_form.title %}
    {% bootstrap_field event_form.type %}
    {% bootstrap_field event_form.description %}
    <div class="input-group date" id="datetimepicker6">
        <span class="input-group-addon datepickerbutton">
            <span class="glyphicon glyphicon-calendar"></span>
        </span>
        <br>
        {% bootstrap_field event_form.start_date_time %}
        <span class="input-group-addon">
            <span class="glyphicon glyphicon-remove"></span>
        </span>
    </div>
    {% bootstrap_field event_form.place %}
    <div id="map" style="width: 50%; height: 300px;">
        <label id="place_label">Search place for selected.</label>
    </div>
    <br>
    <hr>
    {% buttons %}
        <button name="submit" class="btn btn-primary">Создать</button>
    {% endbuttons %}
    <input type="hidden" name="next" value="{% url 'index' %}"/>
</form>
{% endblock content %}

{% block extra_body %}
{% load static %}
<script src="http://api-maps.yandex.ru/2.1.17/?lang=en" type="text/javascript"></script>
<script>
$(document).ready(function() {

    function init_datetime() {
        $('#datetimepicker6').datetimepicker(
        {
            locale: 'ru',
            format: 'DD/MM/YYYY HH:mm',
            sideBySide: true
        });
        $('.glyphicon-remove').click(function () {
            $('#datetimepicker6').data("DateTimePicker").clear();
        });
    }

    init_datetime();
    ymaps.ready(init);

    function init(){

    var myMap;

    myMap = new ymaps.Map("map", {
        center: [55.76, 37.64],
        zoom: 13,
        controls: []
    });

    myMap.behaviors.disable('scrollZoom');
    myMap.controls.add("zoomControl", {
        position: {top: 15, left: 15}
    });

    var searchControl = new ymaps.control.SearchControl({
        options: {
            provider: 'yandex#map'
        }
    });

    myMap.controls.add(searchControl);

    searchControl.events.add('resultselect', function (e) {

    var results = searchControl.getResultsArray();
    var selected = e.get('index');
    var result = results[selected];
    $('#id_place').val(result.properties.get('text'));
    $('#place_label').html("Your selected place: " + $('#id_place').val());
})
}

});
</script>
{% endblock extra_body %}